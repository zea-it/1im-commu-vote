<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1IM Community Vote System</title>
    
    <!-- Favicon -->
    <link rel="icon" href="/1im-commu-vote/icon.ico" type="image/x-icon">

    <!-- Fonts: Kanit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons: Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #4361ee;
            --primary-hover: #3a56d4;
            --secondary-color: #f72585;
            --bg-color: #f8f9fa;
            --text-color: #2b2d42;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --shadow-hover: 0 15px 35px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            text-align: center;
            padding: 40px 20px;
            margin: 0;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Scrollbar ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Modal */
        body.modal-open { overflow: hidden; }

        /* --- User Bar --- */
        .user-bar {
            display: flex; justify-content: flex-end; align-items: center;
            margin-bottom: 10px; padding: 0 10px; position: absolute; top: 20px; right: 20px; z-index: 100;
        }
        @media (max-width: 600px) { .user-bar { position: static; justify-content: center; margin-bottom: 20px; } }

        .user-info {
            display: flex; align-items: center; gap: 10px; background: #fff;
            padding: 5px 15px 5px 5px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #eee;
        }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; }
        .user-name { font-weight: 500; color: #333; font-size: 0.9em; }
        
        .login-btn {
            background: #5865F2; color: white; text-decoration: none; padding: 8px 16px;
            border-radius: 50px; font-weight: 500; font-size: 0.9em; display: inline-flex;
            align-items: center; gap: 8px; transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(88, 101, 242, 0.3);
        }
        .login-btn:hover { background: #4752c4; transform: translateY(-2px); }

        h1 { color: var(--primary-color); font-weight: 600; font-size: 2.5em; margin-bottom: 10px; margin-top: 30px; text-transform: uppercase; }
        #timer { font-size: 1.2em; color: #555; background: #fff; display: inline-block; padding: 10px 25px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 40px; font-weight: 500; border: 1px solid #eee; transition: color 0.3s; }
        #timer i { margin-right: 8px; color: var(--secondary-color); }

        /* --- Gallery Grid --- */
        .gallery {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px; max-width: 1280px; margin: 0 auto; min-height: 300px;
        }
        .card {
            background: var(--card-bg); border-radius: 20px; overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; box-shadow: var(--shadow);
            display: flex; flex-direction: column; border: 1px solid #f0f0f0;
            opacity: 0; animation: fadeIn 0.5s ease forwards;
        }
        @keyframes fadeIn { to { opacity: 1; } }
        .card.winner-1 { border: 3px solid #FFD700; transform: scale(1.05); z-index: 10; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
        .card.winner-2 { border: 3px solid #C0C0C0; }
        .card.winner-3 { border: 3px solid #CD7F32; }
        .card:hover { transform: translateY(-10px); box-shadow: var(--shadow-hover); }
        .card img { width: 100%; height: 260px; object-fit: cover; cursor: pointer; transition: transform 0.5s ease; }
        .card:hover img { transform: scale(1.05); }
        
        .info { padding: 20px; background: #fff; display: flex; flex-direction: column; gap: 10px; }
        .author { font-weight: 500; color: #333; font-size: 1.2em; }
        
        /* Vote Button Styles */
        .vote-btn {
            background: linear-gradient(135deg, var(--primary-color), #304ffe); color: white;
            border: none; padding: 12px; border-radius: 12px; cursor: pointer; width: 100%;
            font-size: 1em; font-family: 'Kanit'; font-weight: 500; transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        .vote-btn:hover { transform: translateY(-2px); }
        .vote-btn:disabled { background: #e0e0e0; cursor: not-allowed; color: #999; box-shadow: none; transform: none; background-image: none; }
        
        .vote-btn.waiting { 
            background: #ffc107 !important; 
            color: #444 !important; 
            cursor: not-allowed; 
            opacity: 1 !important;
        }

        .votes-count, .rank-badge { position: absolute; z-index: 2; background: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; }
        .votes-count { top: 15px; right: 15px; border-radius: 30px; padding: 6px 14px; color: var(--primary-color); font-weight: bold; }
        .rank-badge { top: 10px; left: 10px; width: 45px; height: 45px; font-size: 1.4em; }
        .rank-badge.gold { color: #FFD700; border: 2px solid #FFD700; }
        .rank-badge.silver { color: #C0C0C0; border: 2px solid #C0C0C0; }
        .rank-badge.bronze { color: #CD7F32; border: 2px solid #CD7F32; }

        /* --- Modal (Immersive Viewer) --- */
        .modal { 
            display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); backdrop-filter: blur(8px);
        }
        
        .modal-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; width: 100%; position: relative;
        }

        .image-wrapper {
            position: relative; width: 100%; height: 100%; /* ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡πÄ‡∏™‡∏°‡∏≠ */
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }

        .modal-content { 
            max-width: 95%; max-height: 95%; 
            border-radius: 4px; box-shadow: 0 0 50px rgba(0,0,0,0.5); 
            transition: transform 0.1s ease-out; cursor: grab; user-select: none;
        }
        .modal-content:active { cursor: grabbing; }

        /* --- Tools & Bar (Desktop) --- */
        .image-tools {
            position: absolute; right: 100px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px; 
            background: rgba(255, 255, 255, 0.1); padding: 15px 10px;
            border-radius: 50px; z-index: 1010; backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .tool-btn {
            color: white; font-size: 1.2em; cursor: pointer; transition: 0.2s;
            background: none; border: none; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center; border-radius: 50%;
        }
        .tool-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }

        /* ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (Author + Vote) */
        .bottom-bar {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; align-items: center; gap: 20px;
            background: white; padding: 10px 25px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1005;
            min-width: 300px; justify-content: space-between;
            animation: slideUp 0.3s ease;
        }
        .bottom-info h3 { margin: 0; font-size: 1.1em; color: #333; display: flex; align-items: center; gap: 8px; }
        
        .comment-toggle-btn {
            background: #f0f2f5; color: #555; border: none; width: 40px; height: 40px;
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.1em; transition: 0.2s; position: relative;
        }
        .comment-toggle-btn:hover { background: #e4e6eb; color: var(--primary-color); }
        .badge {
            position: absolute; top: -5px; right: -5px; background: var(--secondary-color); color: white;
            font-size: 0.7em; width: 18px; height: 18px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; border: 2px solid white;
        }

        /* --- Mobile Adjustments --- */
        @media (max-width: 768px) {
            .image-tools {
                right: auto; top: auto; bottom: 110px; 
                left: 50%; transform: translateX(-50%);
                flex-direction: row; padding: 8px 16px; border-radius: 30px;
                background: rgba(0,0,0,0.6);
                gap: 20px; 
            }
            .bottom-bar { bottom: 20px; width: 90%; box-sizing: border-box; }
            .prev, .next { z-index: 1020; background: rgba(0,0,0,0.4); }
        }

        /* --- Comment Sheet (Slide Up) --- */
        .comment-sheet {
            position: fixed; left: 0; bottom: -100%; width: 100%; height: 60vh;
            background: white; border-radius: 20px 20px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3); z-index: 2000;
            transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        .comment-sheet.active { bottom: 0; }
        
        .sheet-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .sheet-body { flex-grow: 1; overflow-y: auto; padding: 20px; background: #f9f9f9; }
        .sheet-footer { padding: 15px 20px; border-top: 1px solid #eee; background: white; }
        
        .comment-item { display: flex; gap: 12px; margin-bottom: 15px; }
        .comment-avatar { width: 35px; height: 35px; border-radius: 50%; }
        .comment-bubble { background: white; padding: 10px 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); flex-grow: 1; text-align: left; }
        .comment-user { font-weight: 600; font-size: 0.9em; color: #333; margin-bottom: 2px; }
        .comment-text { font-size: 0.95em; color: #555; word-break: break-word; }
        .comment-time { font-size: 0.75em; color: #aaa; margin-top: 4px; text-align: right; }

        .comment-form { display: flex; gap: 10px; }
        .comment-input { flex-grow: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 25px; outline: none; }
        .send-btn { background: var(--primary-color); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .send-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* Navigation Arrows */
        .prev, .next {
            cursor: pointer; position: absolute; top: 50%; width: auto; padding: 16px;
            margin-top: -50px; color: white; font-weight: bold; font-size: 40px;
            transition: 0.3s; border-radius: 50%; background: rgba(255, 255, 255, 0.1);
            user-select: none; z-index: 1002; text-decoration: none;
        }
        .prev { left: 20px; } .next { right: 20px; }
        .prev:hover, .next:hover { background-color: rgba(255, 255, 255, 0.3); }
        .close { position: absolute; top: 20px; right: 30px; color: #fff; font-size: 40px; font-weight: bold; cursor: pointer; z-index: 1020; }

        /* Privacy */
        .privacy-box { background: white; width: 90%; max-width: 600px; margin: 10vh auto; padding: 40px; border-radius: 20px; text-align: left; position: relative; animation: zoomIn 0.3s ease; }
        .info-toggle { position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: #2b2d42; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 900; transition: 0.3s; }
        .privacy-box .close-btn-inner { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; float: right; margin-top: 10px; }
        .contact-link { color: var(--secondary-color); font-weight: bold; text-decoration: none; }
        .contact-link:hover { text-decoration: underline; }
        
        @keyframes slideUp { from {transform:translate(-50%, 20px); opacity:0} to {transform:translate(-50%, 0); opacity:1} }
        @keyframes zoomIn { from {transform:scale(0.8); opacity:0} to {transform:scale(1); opacity:1} }

        /* Loading */
        .loading-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #e1e4e8; border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        .loading-text { font-size: 1.2em; color: #888; font-weight: 300; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="user-bar" id="userBar"></div>

    <h1><i class="fa-solid fa-square-poll-vertical"></i> 1IM Community Vote System</h1>
    <div id="timer"><i class="fa-solid fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

    <div class="gallery" id="gallery">
        <div class="loading-container"><div class="spinner"></div><div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div></div>
    </div>

    <!-- Image Viewer Modal (‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö) -->
    <div id="modal" class="modal">
        <span class="close" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></span>
        <a class="prev" onclick="changeImage(-1)">&#10094;</a>
        <a class="next" onclick="changeImage(1)">&#10095;</a>

        <div class="modal-container">
            <!-- 1. ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å) -->
            <div class="image-wrapper" id="imgWrapper">
                <img class="modal-content" id="img01">
            </div>

            <!-- 2. ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô Desktop / ‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á Mobile) -->
            <div class="image-tools">
                <button class="tool-btn" onclick="zoomImage(0.2)" title="Zoom In"><i class="fa-solid fa-magnifying-glass-plus"></i></button>
                <button class="tool-btn" onclick="zoomImage(-0.2)" title="Zoom Out"><i class="fa-solid fa-magnifying-glass-minus"></i></button>
                <button class="tool-btn" onclick="resetZoom()" title="Reset"><i class="fa-solid fa-compress"></i></button>
                <button class="tool-btn" onclick="toggleFullScreen()" title="Full Screen"><i class="fa-solid fa-expand"></i></button>
            </div>
            
            <!-- 3. ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡∏•‡∏≠‡∏¢‡∏ï‡∏±‡∏ß ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°) -->
            <div class="bottom-bar">
                <div class="bottom-info">
                    <h3 id="modal-author"><i class="fa-solid fa-user-pen"></i> <span>Author</span></h3>
                </div>
                <div style="display:flex; gap:10px; align-items:center;">
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå -->
                    <button class="comment-toggle-btn" onclick="toggleCommentSheet()">
                        <i class="fa-regular fa-comments"></i>
                        <span class="badge" id="comment-count-badge">0</span>
                    </button>
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï -->
                    <button id="modal-vote-btn" class="vote-btn" style="width: 140px; padding: 10px;">‡πÇ‡∏´‡∏ß‡∏ï</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Sheet (‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô) -->
    <div class="comment-sheet" id="commentSheet">
        <div class="sheet-header">
            <h3><i class="fa-regular fa-comments"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h3>
            <span style="cursor:pointer; font-size:1.2em;" onclick="toggleCommentSheet()"><i class="fa-solid fa-xmark"></i></span>
        </div>
        <div class="sheet-body">
            <div id="comments-list"></div>
        </div>
        <div class="sheet-footer">
            <div id="comment-input-area" class="comment-form">
                <input type="text" class="comment-input" id="comment-input" placeholder="‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..." maxlength="200">
                <button class="send-btn" id="send-comment-btn" onclick="sendComment()"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
            <div id="login-warning" style="display:none; color:red; font-size:0.9em; text-align:center; padding:10px;">
                <i class="fa-brands fa-discord"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
            </div>
        </div>
    </div>

    <!-- Privacy Info Button & Modal -->
    <div class="info-toggle" onclick="openPrivacyModal()">
        <i class="fa-solid fa-info"></i>
    </div>

    <div id="privacyModal" class="modal">
        <div class="privacy-box">
            <h2><i class="fa-solid fa-shield-halved"></i> ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</h2>
            <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
            <h3><i class="fa-brands fa-discord" style="color:#5865F2;"></i> ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Discord</h3>
            <p>
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Discord ‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠ <strong>"‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡πÅ‡∏õ‡∏° 
                ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Login ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á Discord ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ID 
                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô
            </p>

            <h3><i class="fa-solid fa-copyright" style="color:#ffae00;"></i> ‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h3>
            <p>
                ‡∏†‡∏≤‡∏û‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á 
                ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏¥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏î‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å ‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï 
                ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÅ‡∏•‡∏∞‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
            </p>

            <h3><i class="fa-solid fa-bug" style="color:#f72585;"></i> ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <p>
                ‡∏´‡∏≤‡∏Å‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏ö‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà zc. <br>
                <a href="https://x.com/Izc_it" target="_blank" class="contact-link">
                    <i class="fa-brands fa-x-twitter"></i> https://x.com/Izc_it
                </a>
            </p>

            <button class="close-btn-inner" onclick="closePrivacyModal()">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
            <div style="clear:both;"></div>
        </div>
    </div>

<script>
    // ==========================================
    // üî¥ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üî¥
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzBP1KTOwKYil3v-OOE6o3fwXchmP9MnU29Nx5uqyrRod9aI7YycaxTRN0eogfBLy64g/exec"; 
    const CLIENT_ID = "1435981351290409103"; 
    // ==========================================
    
    const REDIRECT_URI = window.location.href.split('?')[0]; 

    let sessionKey = localStorage.getItem("vote_session_key");
    let userProfile = JSON.parse(localStorage.getItem("vote_user_profile") || "null");
    let isVotingOpen = false;
    let isSubmitting = false; // üî• ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏£‡∏±‡∏ß
    let allItems = []; let allComments = []; 
    let currentImageIndex = 0; let serverStatusGlobal = "WAITING"; 

    // Image Zoom Variables
    let currentScale = 1; let isDragging = false;
    let startX, startY, translateX = 0, translateY = 0;
    const imgElement = document.getElementById("img01");

    function zoomImage(step) {
        currentScale += step;
        if (currentScale < 1) currentScale = 1; 
        if (currentScale > 5) currentScale = 5;
        updateTransform();
    }
    function resetZoom() { currentScale = 1; translateX = 0; translateY = 0; updateTransform(); }
    function updateTransform() {
        imgElement.style.transform = `translate(${translateX}px, ${translateY}px) scale(${currentScale})`;
        imgElement.style.cursor = currentScale > 1 ? "grab" : "default";
    }

    imgElement.addEventListener('mousedown', (e) => {
        if (currentScale > 1) { isDragging = true; startX = e.clientX - translateX; startY = e.clientY - translateY; imgElement.style.cursor = "grabbing"; }
    });
    window.addEventListener('mousemove', (e) => {
        if (isDragging) { e.preventDefault(); translateX = e.clientX - startX; translateY = e.clientY - startY; updateTransform(); }
    });
    window.addEventListener('mouseup', () => { isDragging = false; if(currentScale > 1) imgElement.style.cursor = "grab"; });
    imgElement.addEventListener('touchstart', (e) => {
        if (currentScale > 1 && e.touches.length === 1) { isDragging = true; startX = e.touches[0].clientX - translateX; startY = e.touches[0].clientY - translateY; }
    });
    window.addEventListener('touchmove', (e) => {
        if (isDragging && e.touches.length === 1) { translateX = e.touches[0].clientX - startX; translateY = e.touches[0].clientY - startY; updateTransform(); }
    });
    window.addEventListener('touchend', () => { isDragging = false; });

    function toggleFullScreen() {
        const modal = document.getElementById("modal");
        if (!document.fullscreenElement) {
            if(modal.requestFullscreen) modal.requestFullscreen();
            else if(modal.webkitRequestFullscreen) modal.webkitRequestFullscreen();
        } else { if(document.exitFullscreen) document.exitFullscreen(); }
    }

    function toggleCommentSheet() {
        document.getElementById("commentSheet").classList.toggle("active");
    }

    async function checkLogin() {
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        if (code) {
            try {
                const loginRes = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "login", code: code }) });
                const loginData = await loginRes.json();
                if (loginData.status === "success") {
                    sessionKey = loginData.session_key; userProfile = loginData.user;
                    localStorage.setItem("vote_session_key", sessionKey); localStorage.setItem("vote_user_profile", JSON.stringify(userProfile));
                    window.history.replaceState({}, document.title, window.location.pathname);
                } else { alert("Login Failed"); }
            } catch (e) {}
        }
        renderUserBar();
    }

    function renderUserBar() {
        const bar = document.getElementById("userBar");
        if (userProfile) {
            const avatarUrl = userProfile.avatar ? `https://cdn.discordapp.com/avatars/${userProfile.id}/${userProfile.avatar}.png` : `https://cdn.discordapp.com/embed/avatars/0.png`;
            bar.innerHTML = `<div class="user-info"><img src="${avatarUrl}" class="user-avatar"><span class="user-name">${userProfile.username}</span><button onclick="logout()" style="margin-left:8px; border:none; background:none; cursor:pointer; color:#ff5555;"><i class="fa-solid fa-right-from-bracket"></i></button></div>`;
        } else {
            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=identify`;
            bar.innerHTML = `<a href="${authUrl}" class="login-btn"><i class="fa-brands fa-discord"></i> Login</a>`;
        }
    }
    function logout() { if(confirm("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) { localStorage.removeItem("vote_session_key"); localStorage.removeItem("vote_user_profile"); location.reload(); } }

    async function loadData() {
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            serverStatusGlobal = data.votingStatus; 
            handleTimer(data.endTime, serverStatusGlobal);
            allComments = data.comments || [];
            
            const gallery = document.getElementById("gallery"); gallery.innerHTML = ""; 
            if (data.entries.length === 0) { gallery.innerHTML = "<p style='margin-top:50px;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>"; return; }

            allItems = data.entries.map(item => ({ ...item, score: data.votes[item.id] || 0 }));
            if (serverStatusGlobal === "CLOSED") allItems.sort((a, b) => b.score - a.score); else allItems.sort((a, b) => a.id - b.id);

            allItems.forEach((item, index) => {
                const card = document.createElement("div"); card.className = "card";
                let rankBadge = ""; let btnText = '‡πÇ‡∏´‡∏ß‡∏ï'; let btnClass = ""; let btnDisabled = false;

                if (serverStatusGlobal === "CLOSED") {
                    btnText = "‡∏à‡∏ö"; btnDisabled = true;
                    if (index === 0) { card.classList.add("winner-1"); rankBadge = "<div class='rank-badge gold'><i class='fa-solid fa-crown'></i></div>"; }
                    else if (index === 1) { card.classList.add("winner-2"); rankBadge = "<div class='rank-badge silver'><i class='fa-solid fa-medal'></i></div>"; }
                    else if (index === 2) { card.classList.add("winner-3"); rankBadge = "<div class='rank-badge bronze'><i class='fa-solid fa-medal'></i></div>"; }
                    else { rankBadge = `<div class='rank-badge' style='color:#555; border:2px solid #eee; font-size:1.2em; font-weight:bold;'>${index + 1}</div>`; }
                } else if (serverStatusGlobal === "WAITING") {
                    btnText = '‡∏£‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï'; btnClass = "waiting"; btnDisabled = true;
                }

                card.innerHTML = `
                    ${rankBadge}
                    <div class="votes-count"><i class="fa-solid fa-star text-warning"></i> ${item.score}</div>
                    <div class="img-container"><img src="${item.url}" onclick="openModal(${index})" loading="lazy"></div>
                    <div class="info">
                        <div class="author"><i class="fa-solid fa-user-pen"></i> ${item.author}</div>
                        <button class="vote-btn ${btnClass}" id="btn-${item.id}" onclick="vote('${item.id}')" ${btnDisabled ? 'disabled' : ''}>${btnText}</button>
                    </div>`;
                gallery.appendChild(card);
            });
        } catch (error) { 
            // ‡πÅ‡∏™‡∏î‡∏á Error ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
            document.getElementById("gallery").innerHTML = `<div class='loading-text' style='color:red;'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</div>`;
        }
    }

    function handleTimer(endTimeStr, status) {
        const timerElem = document.getElementById("timer");
        if (status === "WAITING") { 
            timerElem.innerHTML = "<i class='fa-solid fa-hourglass'></i> ‡∏£‡∏≠ Admin ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï..."; 
            timerElem.style.color = "#d4a017"; 
            isVotingOpen = false; 
            return; 
        }
        if (status === "CLOSED") { 
            timerElem.innerHTML = "<i class='fa-solid fa-flag-checkered'></i> ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß"; 
            timerElem.style.color = "#d4a017"; 
            isVotingOpen = false; 
            return; 
        }
        
        // üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (Robust Time Parsing)
        const endTime = new Date(endTimeStr).getTime();
        if (isNaN(endTime)) { timerElem.innerHTML = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï"; isVotingOpen = true; return; }

        const interval = setInterval(() => {
            const now = new Date().getTime();
            const distance = endTime - now;
            
            if (distance < 0) { 
                clearInterval(interval); 
                timerElem.innerHTML = "<i class='fa-solid fa-clock'></i> ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤"; 
                timerElem.style.color = "#555";
                isVotingOpen = false; 
                setTimeout(() => location.reload(), 2000); 
            } else { 
                isVotingOpen = true; 
                const h = Math.floor(distance/3600000); 
                const m = Math.floor((distance%3600000)/60000); 
                const s = Math.floor((distance%60000)/1000);
                
                // üî• ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏ó‡∏£‡∏≤‡∏¢
                timerElem.innerHTML = `<i class='fa-solid fa-hourglass-half'></i> ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï‡πÉ‡∏ô: ${h}‡∏ä‡∏°. ${m}‡∏ô. ${s}‡∏ß‡∏¥.`;
                timerElem.style.color = "#f72585";
            }
        }, 1000);
    }

    function vote(itemId) {
        if (!isVotingOpen) return;
        if (!sessionKey) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login"); return; }
        if (isSubmitting) return; // üî• ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥

        const btnGallery = document.getElementById(`btn-${itemId}`);
        const btnModal = document.getElementById(`modal-vote-btn`);
        const originalTextGallery = btnGallery ? btnGallery.innerHTML : "";
        const originalTextModal = btnModal ? btnModal.innerHTML : "";

        // üî• ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
        isSubmitting = true;
        if(btnGallery) { btnGallery.disabled = true; btnGallery.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>'; }
        if(btnModal) { btnModal.disabled = true; btnModal.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>'; }

        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type':'text/plain'}, body: JSON.stringify({ action: "vote", session_key: sessionKey, voted_for_id: itemId }) })
        .then(() => { 
            setTimeout(() => { 
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!"); 
                location.reload(); 
            }, 1000); 
        })
        .catch(() => {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
            isSubmitting = false;
            // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°
            if(btnGallery) { btnGallery.disabled = false; btnGallery.innerHTML = originalTextGallery; }
            if(btnModal) { btnModal.disabled = false; btnModal.innerHTML = originalTextModal; }
        });
    }

    function openModal(index) {
        currentImageIndex = index; updateModalContent();
        document.getElementById("modal").style.display = "block";
        document.body.classList.add("modal-open");
        resetZoom();
    }
    function closeModal() {
        document.getElementById("modal").style.display = "none";
        document.body.classList.remove("modal-open");
        document.getElementById("commentSheet").classList.remove("active");
    }

    function updateModalContent() {
        if (allItems.length === 0) return;
        const item = allItems[currentImageIndex];
        document.getElementById("img01").src = item.url;
        document.querySelector("#modal-author span").innerText = item.author;

        const btn = document.getElementById("modal-vote-btn");
        btn.onclick = () => vote(item.id);
        
        btn.classList.remove('waiting');
        if (serverStatusGlobal === "CLOSED") { btn.innerText = "‡∏à‡∏ö"; btn.disabled = true; }
        else if (serverStatusGlobal === "WAITING") { 
            btn.innerText = "‡∏£‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï"; 
            btn.disabled = true; 
            btn.classList.add('waiting'); 
        }
        else { btn.innerText = "‡πÇ‡∏´‡∏ß‡∏ï"; btn.disabled = !isVotingOpen; }

        renderComments(item.id);
    }

    function renderComments(imageId) {
        const comments = allComments.filter(c => c.imageId.replace(/'/g, '') == String(imageId).replace(/'/g, ''));
        document.getElementById("comment-count-badge").innerText = comments.length;
        
        const list = document.getElementById("comments-list");
        list.innerHTML = "";
        if (comments.length === 0) list.innerHTML = "<div style='text-align:center; color:#ccc; margin-top:20px;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</div>";
        else {
            comments.forEach(c => {
                const avatar = c.avatar ? `https://cdn.discordapp.com/avatars/${c.userId.replace(/'/g, '')}/${c.avatar}.png` : `https://cdn.discordapp.com/embed/avatars/0.png`;
                const time = new Date(c.timestamp).toLocaleString('th-TH', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                list.insertAdjacentHTML('beforeend', `
                    <div class="comment-item">
                        <img src="${avatar}" class="comment-avatar">
                        <div class="comment-bubble">
                            <div class="comment-user">${c.username}</div>
                            <div class="comment-text">${c.text}</div>
                            <div class="comment-time">${time}</div>
                        </div>
                    </div>
                `);
            });
        }
        
        document.getElementById("comment-input-area").style.display = sessionKey ? "flex" : "none";
        document.getElementById("login-warning").style.display = sessionKey ? "none" : "block";
    }

    function sendComment() {
        if (!sessionKey) return;
        if (isSubmitting) return; // üî• ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥

        const input = document.getElementById("comment-input");
        const text = input.value.trim();
        const item = allItems[currentImageIndex];
        if (!text || !item) return;

        // üî• ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á
        isSubmitting = true;
        const btn = document.getElementById("send-comment-btn");
        const originalHtml = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
        input.disabled = true;

        const payload = JSON.stringify({ action: "add_comment", session_key: sessionKey, image_id: item.id, comment: text });
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type':'text/plain'}, body: payload })
        .then(() => {
            allComments.push({ timestamp: new Date().toISOString(), imageId: item.id, userId: userProfile.id, username: userProfile.username, avatar: userProfile.avatar, text: text });
            renderComments(item.id); 
            input.value = "";
            
            // üî• ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å
            btn.disabled = false;
            btn.innerHTML = originalHtml;
            input.disabled = false;
            isSubmitting = false;
            input.focus();
        })
        .catch(() => {
            alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            btn.disabled = false;
            btn.innerHTML = originalHtml;
            input.disabled = false;
            isSubmitting = false;
        });
    }

    function changeImage(step) {
        currentImageIndex += step;
        if (currentImageIndex >= allItems.length) currentImageIndex = 0; else if (currentImageIndex < 0) currentImageIndex = allItems.length - 1;
        updateModalContent(); resetZoom();
    }

    document.addEventListener('keydown', (e) => {
        if (document.getElementById("modal").style.display === "block") {
            if (e.key === "ArrowLeft") changeImage(-1); if (e.key === "ArrowRight") changeImage(1); if (e.key === "Escape") closeModal();
        }
    });

    let touchStartX = 0;
    const modalContent = document.getElementById("modal");
    modalContent.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
    modalContent.addEventListener('touchend', (e) => {
        if(currentScale === 1 && Math.abs(e.changedTouches[0].screenX - touchStartX) > 50) changeImage(e.changedTouches[0].screenX < touchStartX ? 1 : -1);
    }, {passive: true});

    function openPrivacyModal() { document.getElementById("privacyModal").style.display = "block"; }
    function closePrivacyModal() { document.getElementById("privacyModal").style.display = "none"; }
    window.onclick = function(event) { if (event.target == document.getElementById("modal")) closeModal(); if (event.target == document.getElementById("privacyModal")) closePrivacyModal(); }

    checkLogin(); loadData();
</script>
</body>
</html>
